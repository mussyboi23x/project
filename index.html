<!DOCTYPE html>
<html>
<head>
<title>Simple 3D Game (Mobile Controls)</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    touch-action: none;
  }
  canvas {
    width: 100vw;
    height: 100vh;
    display: block;
  }
  #controls {
    position: absolute;
    bottom: 10vh;
    left: 5vw;
    display: flex;
    flex-wrap: wrap;
    width: 90vw;
    justify-content: center;
  }
  .control-button {
    width: 40px;
    height: 40px;
    background-color: rgba(0, 0, 0, 0.5);
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 3px;
    border-radius: 50%;
    user-select: none;
  }
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div id="controls">
    <div class="control-button" id="up">W</div>
    <div class="control-button" id="down">S</div>
    <div class="control-button" id="left">A</div>
    <div class="control-button" id="right">D</div>
    <div class="control-button" id="forward">Q</div>
    <div class="control-button" id="backward">E</div>
</div>

<script>
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  let playerX = canvas.width / 2;
  let playerY = canvas.height / 2;
  let playerZ = 0;
  const playerSize = 20;
  const playerSpeed = 5;

  const cubeSize = 50;
  const cubeX = canvas.width / 2 + 100;
  const cubeY = canvas.height / 2;
  let cubeZ = 100;

  function project(x, y, z) {
    const focalLength = 200;
    const perspective = focalLength / (focalLength + z);
    const projectedX = x * perspective + canvas.width / 2;
    const projectedY = y * perspective + canvas.height / 2;
    return { x: projectedX, y: projectedY, perspective: perspective };
  }

  function drawCube(x, y, z) {
    const points = [
      { x: x - cubeSize / 2, y: y - cubeSize / 2, z: z - cubeSize / 2 },
      { x: x + cubeSize / 2, y: y - cubeSize / 2, z: z - cubeSize / 2 },
      { x: x + cubeSize / 2, y: y + cubeSize / 2, z: z - cubeSize / 2 },
      { x: x - cubeSize / 2, y: y + cubeSize / 2, z: z - cubeSize / 2 },
      { x: x - cubeSize / 2, y: y - cubeSize / 2, z: z + cubeSize / 2 },
      { x: x + cubeSize / 2, y: y - cubeSize / 2, z: z + cubeSize / 2 },
      { x: x + cubeSize / 2, y: y + cubeSize / 2, z: z + cubeSize / 2 },
      { x: x - cubeSize / 2, y: y + cubeSize / 2, z: z + cubeSize / 2 },
    ];

    const projectedPoints = points.map(point => project(point.x, point.y, point.z));

    const faces = [
      [0, 1, 2, 3],
      [4, 5, 6, 7],
      [0, 4, 7, 3],
      [1, 5, 6, 2],
      [0, 1, 5, 4],
      [3, 2, 6, 7],
    ];

    faces.forEach(face => {
      ctx.beginPath();
      ctx.moveTo(projectedPoints[face[0]].x, projectedPoints[face[0]].y);
      for (let i = 1; i < face.length; i++) {
        ctx.lineTo(projectedPoints[face[i]].x, projectedPoints[face[i]].y);
      }
      ctx.closePath();
      ctx.fillStyle = 'gray';
      ctx.fill();
      ctx.strokeStyle = 'black';
      ctx.stroke();

    });

  }

  function drawPlayer() {
    const projectedPlayer = project(playerX, playerY, playerZ);
    ctx.fillStyle = 'red';
    ctx.fillRect(projectedPlayer.x - playerSize / 2, projectedPlayer.y - playerSize / 2, playerSize, playerSize);
  }

  function update() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    drawPlayer();
    drawCube(cubeX, cubeY, cubeZ);

    requestAnimationFrame(update);
  }

  const buttons = {
    up: document.getElementById('up'),
    down: document.getElementById('down'),
    left: document.getElementById('left'),
    right: document.getElementById('right'),
    forward: document.getElementById('forward'),
    backward: document.getElementById('backward'),
  };

  function handleButton(button, action) {
    button.addEventListener('touchstart', (event) => {
      event.preventDefault();
      action();
    });
    button.addEventListener('mousedown', action);
  }

  handleButton(buttons.up, () => playerY -= playerSpeed);
  handleButton(buttons.down, () => playerY += playerSpeed);
  handleButton(buttons.left, () => playerX -= playerSpeed);
  handleButton(buttons.right, () => playerX += playerSpeed);
  handleButton(buttons.forward, () => playerZ -= playerSpeed);
  handleButton(buttons.backward, () => playerZ += playerSpeed);

  document.addEventListener('keydown', (event) => {
    switch (event.key) {
      case 'w': playerY -= playerSpeed; break;
      case 's': playerY += playerSpeed; break;
      case 'a': playerX -= playerSpeed; break;
      case 'd': playerX += playerSpeed; break;
      case 'q': playerZ -= playerSpeed; break;
      case 'e': playerZ += playerSpeed; break;
    }
  });

  update();
</script>
</body>
</html>
